{"version":3,"sources":["custom-status-block.jsx"],"names":["__","wp","i18n","PluginPostStatusInfo","editPost","registerPlugin","plugins","data","withSelect","withDispatch","compose","SelectControl","components","statuses","window","PPCustomStatuses","map","s","label","name","value","slug","getStatusLabel","item","find","filter","sideEffectL10nManipulation","status","statusLabel","setTimeout","node","document","querySelector","innerText","dataset","ppInnerTextUpdated","setInterval","select","getEditedPostAttribute","PPCustomPostStatusInfo","onUpdate","plugin","dispatch","icon","render"],"mappings":"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","sourcesContent":["/**\n * ------------------------------------------------------------------------------\n * Based on Edit Flow\n * Author: Daniel Bachhuber, Scott Bressler, Mohammad Jangda, Automattic, and\n * others\n * Copyright (c) 2009-2019 Mohammad Jangda, Daniel Bachhuber, et al.\n * ------------------------------------------------------------------------------\n */\n\nlet {__} = wp.i18n;\nlet {PluginPostStatusInfo} = wp.editPost;\nlet {registerPlugin} = wp.plugins;\nlet {withSelect, withDispatch} = wp.data;\nlet {compose} = wp.compose;\nlet {SelectControl} = wp.components;\n\n/**\n * Map Custom Statuses as options for SelectControl\n */\nlet statuses = window.PPCustomStatuses.map(s => ({label: s.name, value: s.slug}));\nlet getStatusLabel = slug => {\n    let item = statuses.find(s => s.value === slug);\n\n    if (item) {\n        return item.label;\n    }\n\n    return '';\n};\n\n// Remove the Published status from the list.\nstatuses = statuses.filter((item) => {\n    return item.value !== 'publish';\n});\n\n/**\n * Hack :(\n *\n * @see https://github.com/WordPress/gutenberg/issues/3144\n *\n * @param status\n */\nlet sideEffectL10nManipulation = status => {\n\n    if (status === 'publish') {\n        return;\n    }\n\n    let statusLabel = getStatusLabel(status);\n\n    setTimeout(() => {\n        let node = document.querySelector('.editor-post-save-draft');\n\n        if (!node) {\n            node = document.querySelector('.editor-post-switch-to-draft');\n        }\n\n        if (node) {\n            document.querySelector('.editor-post-save-draft, .editor-post-switch-to-draft').innerText = `${__('Save as')} ${statusLabel}`;\n            node.dataset.ppInnerTextUpdated = true;\n        }\n    }, 100);\n};\n\n/**\n * Hack :(\n * We need an interval because the DOM element is removed by autosave and rendered back after finishing.\n *\n * @see https://github.com/WordPress/gutenberg/issues/3144\n */\nsetInterval(() => {\n    let status = wp.data.select('core/editor').getEditedPostAttribute('status');\n\n    if (status === 'publish') {\n        return;\n    }\n\n    let statusLabel = getStatusLabel(status);\n    let node = document.querySelector('.editor-post-save-draft');\n\n    if (!node) {\n        node = document.querySelector('.editor-post-switch-to-draft');\n    }\n\n    if (node && !node.dataset.ppInnerTextUpdated) {\n        document.querySelector('.editor-post-save-draft, .editor-post-switch-to-draft').innerText = `${__('Save as')} ${statusLabel}`;\n        node.dataset.ppInnerTextUpdated = true;\n    }\n}, 250);\n\n/**\n * Custom status component\n * @param object props\n */\nlet PPCustomPostStatusInfo = ({onUpdate, status}) => (\n    <PluginPostStatusInfo\n        className={`publishpress-extended-post-status publishpress-extended-post-status-${status}`}\n    >\n        <h4>{__('Post Status', 'publishpress')}</h4>\n\n        {status !== 'publish' ? <SelectControl\n            label=\"\"\n            value={status}\n            options={statuses}\n            onChange={onUpdate}\n        /> : <div>{__('Published', 'publishpress')}</div>}\n\n        <small className=\"publishpress-extended-post-status-note\">\n            {status !== 'publish' ? __(`Note: this will override all status settings above.`, 'publishpress') : __('To select a custom status, please unpublish the content first.', 'publishpress')}\n        </small>\n    </PluginPostStatusInfo>\n);\n\nlet plugin = compose(\n    withSelect((select) => ({\n        status: select('core/editor').getEditedPostAttribute('status')\n    })),\n    withDispatch((dispatch) => ({\n        onUpdate (status) {\n            dispatch('core/editor').editPost({status});\n            sideEffectL10nManipulation(status);\n        }\n    }))\n)(PPCustomPostStatusInfo);\n\nregisterPlugin('publishpress-custom-status-block', {\n    icon: 'admin-site',\n    render: plugin\n});\n"],"file":"custom-status-block.js"}